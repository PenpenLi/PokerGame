-- MallSellPanel.lua-- created by lyl on 2013-2-17-- 商城出售一件物品的panel区域super_class.MallSellPanel(  ) local _price_rate = 3    -- 价格倍数   写死local _item_count = 1    -- 数量local _panel_width = 220local _pnael_height = 136local _line_y = 80local _line_long = 110local _line_w = 2-- Langlocal txt_lang_info = Lang.mall_info-- 参数：出售物品id   , x, y 可不填。默认13function MallSellPanel:__init( item_id , category, x, y)    local pos_x = x or 0    local pos_y = y or 0    local item_base = ItemConfig:get_item_by_id( item_id )    if item_base == nil then        return     end    if category == "limit" then        self.view = CCBasePanel:panelWithFile( pos_x, pos_y, _panel_width, _pnael_height, UILH_MALL.frame_bg, 500, 500)        -- title 划线        local line = CCZXImage:imageWithFile( 5, 100, 210, -1, UILH_MALL.split_line_y)        self.view:addChild( line )        -- 道具名称        -- local name_color = MallModel:get_item_color( item_id )        self.name = UILabel:create_lable_2( LH_COLOR[1] .. item_base.name, 240/2, 110, 16, ALIGN_CENTER )        self.view:addChild( self.name )    else        self.view = CCBasePanel:panelWithFile( pos_x, pos_y, _panel_width, _pnael_height, UILH_COMMON.bg_11, 500, 500)        self.title_bg = CCBasePanel:panelWithFile( 0, 103, _panel_width, -1, UILH_NORMAL.title_bg4, 500, 500 )        self.view:addChild( self.title_bg )        -- 道具名称        -- local name_color = MallModel:get_item_color( item_id ) -- 颜色        self.name = UILabel:create_lable_2( LH_COLOR[2] .. item_base.name, _panel_width/2, 110, 16, ALIGN_CENTER )        self.view:addChild( self.name )        -- 分割线        self.split_line_v = CCZXImage:imageWithFile( 100, 7, 3, 90, UILH_COMMON.split_line_v )        self.view:addChild( self.split_line_v )    end    -- slot    local size_w = 67    local size_h= 67    self.slot = SlotItem( size_w, size_h )    if category == "limit" then        self.slot:set_icon_bg_texture( UILH_MALL.slot_bg_y, -8, -8, 83, 83 )   -- 背框    else        self.slot:set_icon_bg_texture( UILH_COMMON.slot_bg, -8, -8, 83, 83 )   -- 背框    end    self.slot:setPosition( 18, 20 )    self.slot:set_icon( item_id )    self.slot:set_color_frame( item_id, 0, 0, 68, 68 )    -- 边框颜色    self.view:addChild( self.slot.view )    -- slot单击 --    local function item_click_fun (...)        local x, y, arg = ...        local position = Utils:Split(arg,":");        -- 将相对坐标转化成屏幕坐标(即OpenGL坐标 800x480)        local pos = self.slot.view:getParent():convertToWorldSpace( CCPointMake(position[1],position[2]) );        MallModel:show_mall_tips( item_id, pos.x, pos.y)    end    self.slot:set_click_event(item_click_fun)    -- 原价    local item_mall_info = StoreConfig:get_sell_info_by_cate_id( item_id, category )        -- 该物品的商城信息    if item_mall_info == nil then        return     end    -- -- 如果是限购商品就添加限购标签    -- if item_mall_info.singleBuyLimit ~= 0 then     --     ZImage:create(self.view, UIPIC_MALLWIN_010, 208, 73);   -- 255-47,120-57    -- end    -- -- 如果是新商品就添加新商品标签    -- if item_mall_info.new then    --     ZImage:create(self.view, UIPIC_MALLWIN_011, 208, 73);   -- 255-47,120-57    -- end    local p_offset_x = 110    local p_offset_y = 55 - 10    local p_inter = 30    local font_size = 13    local p_inter_x = 110    -- Lang    -- local txt_mall_info = Land.mall    self.prince_name = StoreConfig.money_type[ item_mall_info.price[1].type ] or ""  -- 金钱类型    if QQVipInterface.QQVipInterface_info == true and QQVipInterface.QQVipInterface_sell_price == true then        if category == "limit" or category == "binding_gold" then              self.prime_cost_value = item_mall_info.price[1].oldPrice                     -- 原价            self.prime_cost_lable = UILabel:create_lable_2( LH_COLOR[13] .. txt_lang_info[1], p_offset_x, p_offset_y+p_inter, font_size, ALIGN_LEFT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable )            self.prime_cost_lable_2 = UILabel:create_lable_2( self.prime_cost_value..self.prince_name.." ", p_offset_x+100, p_offset_y+p_inter, font_size, ALIGN_RIGHT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable_2 )            -- -- 划线            -- local line = CCZXImage:imageWithFile( p_offset_x, _line_y, _line_long, _line_w, UIPIC_MALLWIN_012)            -- self.view:addChild( line )            -- 现价            self.now_cost_value = item_mall_info.price[1].price                          -- 现价             self.now_cost_lable = UILabel:create_lable_2( LH_COLOR[13] .. txt_lang_info[2]..self.now_cost_value..self.prince_name.." ", p_offset_x, p_offset_y, font_size, ALIGN_LEFT ) -- [1477]="#cffff00现价"            self.view:addChild( self.now_cost_lable )        else                 -- 原价            self.now_cost_value = item_mall_info.price[1].oldPrice                            -- 原价            self.now_cost_lable = UILabel:create_lable_2( LH_COLOR[13] .. txt_lang_info[1]..self.now_cost_value..self.prince_name.." ", p_offset_x, p_offset_y+p_inter, font_size, ALIGN_LEFT ) -- [1477]="#cffff00现价"            self.view:addChild( self.now_cost_lable )            -- -- 划线            -- local line = CCZXImage:imageWithFile( p_offset_x, _line_y, _line_long, _line_w, UIPIC_MALLWIN_012)            -- self.view:addChild( line )              -- 现价             self.qqvip_cost_value = item_mall_info.price[1].price                       -- 现价             self.qqvipnow_cost_lable = UILabel:create_lable_2( LH_COLOR[13] .. txt_lang_info[2].. self.qqvip_cost_value..self.prince_name.." ", p_offset_x, p_offset_y, font_size, ALIGN_LEFT ) -- [1478]="#c7cfc00蓝钻"            self.view:addChild( self.qqvipnow_cost_lable )            -- local is_show_shop_price = QQVipInterface:show_shop_price()            -- local play = EntityManager:get_player_avatar()            -- local qqvip_info = QQVIPName:get_user_qq_vip_info(play.QQVIP)            -- if is_show_shop_price then            --     -- 划线            --     local line = CCZXImage:imageWithFile( 70, 60, 102, 2, UIResourcePath.FileLocate.other .. "white_line.png")            --     self.view:addChild( line )            -- else            --     -- 划线            --     local line = CCZXImage:imageWithFile( 70, 40, 102, 2, UIResourcePath.FileLocate.other .. "white_line.png")            --     self.view:addChild( line )                            -- end            -- local play = EntityManager:get_player_avatar()            -- local qqvip_info = UserInfoModel:get_user_qq_vip_info(play.QQVIP)            -- if qqvip_info.is_blue_vip == 1 or qqvip_info.is_super_blue_vip == 1 then            --     self.qqvipnow_cost_lable:setIsVisible( true )            -- else            --     self.qqvipnow_cost_lable:setIsVisible( false )            -- end        end    else        if category == "limit" then            self.prime_cost_value = item_mall_info.price[1].oldPrice                     -- 原价            self.prime_cost_lable = UILabel:create_lable_2( LH_COLOR[2] .. txt_lang_info[15], p_offset_x-15, p_offset_y+p_inter, font_size, ALIGN_LEFT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable )            self.prime_cost_lable_2 = UILabel:create_lable_2( LH_COLOR[2] .. self.prime_cost_value..self.prince_name.." ", p_offset_x+p_inter_x, p_offset_y+p_inter, font_size, ALIGN_RIGHT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable_2 )            -- 划线            local line = CCZXImage:imageWithFile( p_offset_x-15, _line_y, _line_long+10, 3, UILH_MALL.split_line_y)            self.view:addChild( line )            -- 现价            self.now_cost_value = item_mall_info.price[1].price                          -- 现价             self.now_cost_lable = UILabel:create_lable_2( LH_COLOR[15] .. txt_lang_info[16], p_offset_x-15, p_offset_y+10, font_size, ALIGN_LEFT ) -- [1477]="#cffff00现价"            self.view:addChild( self.now_cost_lable )            self.now_cost_lable_2 = UILabel:create_lable_2( LH_COLOR[15] .. self.now_cost_value .. self.prince_name.." ", p_offset_x+p_inter_x, p_offset_y+10, font_size, ALIGN_RIGHT ) -- [1476]="#cffff00原价"            self.view:addChild( self.now_cost_lable_2 )        else            self.prime_cost_value = item_mall_info.price[1].oldPrice                     -- 原价            self.prime_cost_lable = UILabel:create_lable_2( LH_COLOR[13] .. txt_lang_info[1], p_offset_x, p_offset_y+p_inter, font_size, ALIGN_LEFT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable )            self.prime_cost_lable_2 = UILabel:create_lable_2( LH_COLOR[3] .. self.prime_cost_value..self.prince_name.." ", p_offset_x+p_inter_x, p_offset_y+p_inter, font_size, ALIGN_RIGHT ) -- [1476]="#cffff00原价"            self.view:addChild( self.prime_cost_lable_2 )            -- 划线            local line = CCZXImage:imageWithFile( p_offset_x-5, _line_y, _line_long, 3, UILH_MALL.split_line_y)            self.view:addChild( line )            -- 现价            self.now_cost_value = item_mall_info.price[1].price                          -- 现价             self.now_cost_lable = UILabel:create_lable_2(LH_COLOR[13] .. txt_lang_info[2], p_offset_x, p_offset_y+10, font_size, ALIGN_LEFT ) -- [1477]="#cffff00现价"            self.view:addChild( self.now_cost_lable )            self.now_cost_lable_2 = UILabel:create_lable_2( LH_COLOR[3] .. self.now_cost_value .. self.prince_name.." ", p_offset_x+p_inter_x, p_offset_y+10, font_size, ALIGN_RIGHT ) -- [1476]="#cffff00原价"            self.view:addChild( self.now_cost_lable_2 )        end    end    -- -- 购买按钮    local function buy_but_callback(eventType)        if eventType == TOUCH_CLICK then            MallModel:show_buy_keyboard( item_id, category, item_mall_info.singleBuyLimit )            return true        end        return true    end    if category == "limit" then        self.buy_but = MUtils:create_btn( self.view,             UILH_COMMON.button4,   -- 70, 35            UILH_COMMON.button4,            buy_but_callback,             135, 10, -1, -1)    -- 45,37    else        self.buy_but = MUtils:create_btn( self.view,             UILH_COMMON.button4,   -- 70, 35            UILH_COMMON.button4,            buy_but_callback,             135, 10, -1, -1)    -- 45,37    end    -- btn_size(77, 44)    local buy_but_lab = UILabel:create_lable_2( LH_COLOR[2] .. txt_lang_info[8], 77*0.5, (44-font_size)*0.5, font_size, ALIGN_CENTER )    self.buy_but:addChild(buy_but_lab)end